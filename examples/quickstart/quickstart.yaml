AWSTemplateFormatVersion: '2010-09-09'
Description: >-
  This template creates a BIG-IP Standalone WAF solution. The template uses nested
  templates for provisioning network, dag/ingress and compute resources for hosting
  BIG-IP Standalone solution.
Conditions:
  1nic: !Equals
    - 1
    - !Ref 'numNics'
  2nic: !Or
    - !Condition '3nic'
    - !Equals
      - 2
      - !Ref 'numNics'
  3nic: !Equals
    - 3
    - !Ref 'numNics'
  2nicPublic: !And
    - !Condition '2nic'
    - !Condition 'publicIp'
  1nicPublic: !And
    - !Condition '1nic'
    - !Condition 'publicIp'
  noPublicIp: !Equals
    - 'false'
    - !Ref 'provisionPublicIp'
  publicIp: !Equals
    - 'true'
    - !Ref 'provisionPublicIp'
  isPaygLicensing: !Equals
    - payg
    - !Ref 'licenseType'
  noCustomImageId: !Equals
    - ''
    - !Ref 'bigIpCustomImageId'
  useBigIpInstanceProfile: !Not
    - !Equals
      - !Ref 'bigIpInstanceProfile'
      - ""
Mappings:
  AWSBigipThroughput:
    1000Mbps:
      AdvancedWaf: AdvancedWaf1000Mbps
      Best: Best1000Mbps
      PerAppVeAwaf: PerAppVeAwaf1000Mbps
    200Mbps:
      AdvancedWaf: AdvancedWaf200Mbps
      Best: Best200Mbps
      PerAppVeAwaf: PerAppVeAwaf200Mbps
    25Mbps:
      AdvancedWaf: AdvancedWaf25Mbps
      Best: Best25Mbps
      PerAppVeAwaf: PerAppVeAwaf25Mbps
    5000Mbps:
      Best: Best5000Mbps
    10000Mbps:
      Best: Best10000Mbps
  VERSION:
    16-1-3-1-0011:
      REGIONMAP: TMOS161310011
    14-1-4-6-008:
      REGIONMAP: TMOS14146008
  TMOS161310011:
    af-south-1:
      AdvancedWaf200Mbps: ami-0c0973070b9cbc226
      AdvancedWaf25Mbps: ami-024c79d6452392861
      AdvancedWaf3000Mbps: ami-00d21bbda0b482e05
      AllTwoBootLocations: ami-086f44eccf0fd3b29
      Best10000Mbps: ami-0a34fef0abd2cd687
      Best1000Mbps: ami-0f8965db564ad8f28
      Best200Mbps: ami-0d19230717348aaab
      Best25Mbps: ami-010dd291c2d96f16f
      Best5000Mbps: ami-063675bc6cc33d326
    ap-east-1:
      AdvancedWaf200Mbps: ami-0bd62c22a1284d4c5
      AdvancedWaf25Mbps: ami-0228473471bb4170c
      AdvancedWaf3000Mbps: ami-0a7c60bfc3f0a947d
      AllTwoBootLocations: ami-01de85324ae416523
      Best10000Mbps: ami-00c85160aa9b4750a
      Best1000Mbps: ami-0eefade3bbd2d065d
      Best200Mbps: ami-0d812af9d65df84ba
      Best25Mbps: ami-000fc03136e7b87f8
      Best5000Mbps: ami-03bbe25e4afd6d021
    ap-northeast-1:
      AdvancedWaf200Mbps: ami-086ad11f704f0f83c
      AdvancedWaf25Mbps: ami-002065c341201c734
      AdvancedWaf3000Mbps: ami-049e9b92a9cedfc70
      AllTwoBootLocations: ami-05d5294cf9a6f32ca
      Best10000Mbps: ami-06555553bfe62b695
      Best1000Mbps: ami-078c98c3a6bcd8ff3
      Best200Mbps: ami-0fb41506b87f4508b
      Best25Mbps: ami-03f43ab50a5159a06
      Best5000Mbps: ami-01bfb1eb68e4c2b00
    ap-northeast-2:
      AdvancedWaf200Mbps: ami-0143a99c69831ecc4
      AdvancedWaf25Mbps: ami-059615beb84e7265b
      AdvancedWaf3000Mbps: ami-0347c7939a1e0b016
      AllTwoBootLocations: ami-0d37773ecfa64889f
      Best10000Mbps: ami-046f9bc0f5b3b3e3f
      Best1000Mbps: ami-0bf5c56983d9d65da
      Best200Mbps: ami-06296168e78824e04
      Best25Mbps: ami-04f833d93bfc30f2a
      Best5000Mbps: ami-076a124c72f7adcda
    ap-northeast-3:
      AdvancedWaf200Mbps: ami-04da6a60999e19823
      AdvancedWaf25Mbps: ami-06c6dbe7a4deefe0b
      AdvancedWaf3000Mbps: ami-04bbb8c28d7a393a9
      AllTwoBootLocations: ami-0950515fa11f3cc02
      Best10000Mbps: ami-060fd20b085454256
      Best1000Mbps: ami-0f3d9e41b19ad8fb0
      Best200Mbps: ami-002dca3ecb3467d3f
      Best25Mbps: ami-0951bf74999faaec1
      Best5000Mbps: ami-09b892b9858fed312
    ap-south-1:
      AdvancedWaf200Mbps: ami-0bd6df6eb225d8e9b
      AdvancedWaf25Mbps: ami-0bb6f5c3d894a15ea
      AdvancedWaf3000Mbps: ami-0ac0d6091b9028b35
      AllTwoBootLocations: ami-0c3b82e4072d116dd
      Best10000Mbps: ami-070c28da29e27eaa9
      Best1000Mbps: ami-08a0cdb0bbe0c3c92
      Best200Mbps: ami-09203d807a60bdfad
      Best25Mbps: ami-0d33efe532f327351
      Best5000Mbps: ami-09fbe8f93af5f2c31
    ap-southeast-1:
      AdvancedWaf200Mbps: ami-0c2addf05caa19ca1
      AdvancedWaf25Mbps: ami-0d8faf7d6322a7e3a
      AdvancedWaf3000Mbps: ami-048d77f24405d2aed
      AllTwoBootLocations: ami-0b374fe1c11fe9070
      Best10000Mbps: ami-0958cd8c2a95b5fee
      Best1000Mbps: ami-00ef24535918f6e91
      Best200Mbps: ami-0c76b68a3f63534a0
      Best25Mbps: ami-0b18133f70e37728e
      Best5000Mbps: ami-08d94f1b2035d1297
    ap-southeast-2:
      AdvancedWaf200Mbps: ami-03f5f3dd15e3757c3
      AdvancedWaf25Mbps: ami-0259bc2c5c7165b7a
      AdvancedWaf3000Mbps: ami-0c00494a2dab355c5
      AllTwoBootLocations: ami-0f49b9b956467b137
      Best10000Mbps: ami-0543c34bac59e9742
      Best1000Mbps: ami-0a083d6e4bb2c3676
      Best200Mbps: ami-02b557d0d2295773e
      Best25Mbps: ami-0e60e8320d40fd646
      Best5000Mbps: ami-0ab7faf9453593aca
    ca-central-1:
      AdvancedWaf200Mbps: ami-03c5603cdea9a88f6
      AdvancedWaf25Mbps: ami-00fbfd75ce476de69
      AdvancedWaf3000Mbps: ami-093df7d301cf26a29
      AllTwoBootLocations: ami-040934063caea64b4
      Best10000Mbps: ami-06cb6e6c239f49fc8
      Best1000Mbps: ami-01a6f647754e6b13e
      Best200Mbps: ami-06bce699c35811a81
      Best25Mbps: ami-04fe239fdf525d0cf
      Best5000Mbps: ami-0cebce5e33b23f96a
    eu-central-1:
      AdvancedWaf200Mbps: ami-02841faa3d1c76908
      AdvancedWaf25Mbps: ami-07ad6519bc9efc880
      AdvancedWaf3000Mbps: ami-087ecc6c568e1a76f
      AllTwoBootLocations: ami-0ffc0fc9f5b157077
      Best10000Mbps: ami-08bceaa0211f1d8af
      Best1000Mbps: ami-041ac3456ac786f41
      Best200Mbps: ami-02fe410c82bc13d39
      Best25Mbps: ami-084641c0e6eacf26f
      Best5000Mbps: ami-090e6a3bbaaf989f6
    eu-north-1:
      AdvancedWaf200Mbps: ami-0dcd8c4f018c8c8b2
      AdvancedWaf25Mbps: ami-0dc6f99afc815e85a
      AdvancedWaf3000Mbps: ami-09de2069cdcbef76e
      AllTwoBootLocations: ami-0734cfc5633202269
      Best10000Mbps: ami-04c78127e4c8c3830
      Best1000Mbps: ami-06fc39ec34a4a67eb
      Best200Mbps: ami-09557481840f31e17
      Best25Mbps: ami-012778e5cae7d8274
      Best5000Mbps: ami-059b4068408eb78dd
    eu-south-1:
      AdvancedWaf200Mbps: ami-00026ce1c04770edc
      AdvancedWaf25Mbps: ami-0923a6627ee45886c
      AdvancedWaf3000Mbps: ami-0511ff621ba7327bf
      AllTwoBootLocations: ami-0c82ac92445a42316
      Best10000Mbps: ami-0d073d43d250bef58
      Best1000Mbps: ami-029f1acc8bce67d8d
      Best200Mbps: ami-055d5719f49532484
      Best25Mbps: ami-064d030a041f73a82
      Best5000Mbps: ami-0c9da898656cb716e
    eu-west-1:
      AdvancedWaf200Mbps: ami-00a14a8ebea848a93
      AdvancedWaf25Mbps: ami-0e27373b62d12692b
      AdvancedWaf3000Mbps: ami-03588a8e0f81f0d31
      AllTwoBootLocations: ami-0cd9cf7722d6aff6c
      Best10000Mbps: ami-02fb86ccccd6049a4
      Best1000Mbps: ami-0b794d7efdba3e1c6
      Best200Mbps: ami-0266d1c00996a0aa4
      Best25Mbps: ami-0fddd3605816549b5
      Best5000Mbps: ami-0ecefcb478ad6501b
    eu-west-2:
      AdvancedWaf200Mbps: ami-0f7843cb5947d2391
      AdvancedWaf25Mbps: ami-01995d28d8f5be811
      AdvancedWaf3000Mbps: ami-03740eca5be212a4c
      AllTwoBootLocations: ami-051d4399216dc768e
      Best10000Mbps: ami-0ca7736097ca9a135
      Best1000Mbps: ami-06f9d0ebb5329fca8
      Best200Mbps: ami-0fd96f8ae15a4a486
      Best25Mbps: ami-061409601b7bd0c40
      Best5000Mbps: ami-0b0fd9bd0b5867a3c
    eu-west-3:
      AdvancedWaf200Mbps: ami-0a9676fea3200b94d
      AdvancedWaf25Mbps: ami-0de0c93f7175453e1
      AdvancedWaf3000Mbps: ami-03e6c9519784aad6e
      AllTwoBootLocations: ami-04eff2d1222b84395
      Best10000Mbps: ami-0b81c19fba115739c
      Best1000Mbps: ami-063dbd6e6e8e53dfb
      Best200Mbps: ami-0b6299d6645d8c86e
      Best25Mbps: ami-05f7a45845fe9e4a8
      Best5000Mbps: ami-0a14970f236d5dcd2
    me-south-1:
      AdvancedWaf200Mbps: ami-09f47ee9249825620
      AdvancedWaf25Mbps: ami-0156bc2c240537727
      AdvancedWaf3000Mbps: ami-09e7010080b8266a6
      AllTwoBootLocations: ami-006829ae46e74ff8d
      Best10000Mbps: ami-0d801a8521b2be6ed
      Best1000Mbps: ami-0a6b2c2ac9a377cea
      Best200Mbps: ami-0534c6bb7d7a485d2
      Best25Mbps: ami-096cd73a3e1a79648
      Best5000Mbps: ami-0dcec68c229666026
    sa-east-1:
      AdvancedWaf200Mbps: ami-0152e42b1ccc387d3
      AdvancedWaf25Mbps: ami-084685c6f29386b53
      AdvancedWaf3000Mbps: ami-0e2db2844109662f8
      AllTwoBootLocations: ami-0fb18b0b2e5dbb68f
      Best10000Mbps: ami-033e69228b7fa05d3
      Best1000Mbps: ami-012fa1259185c5142
      Best200Mbps: ami-05a37ec8a1cb5bc4e
      Best25Mbps: ami-076e8663b567336f5
      Best5000Mbps: ami-0c75ccbbd9811de37
    us-east-1:
      AdvancedWaf200Mbps: ami-0530e6be2fc8d9e83
      AdvancedWaf25Mbps: ami-08586db31e4b67424
      AdvancedWaf3000Mbps: ami-0590fa04d8344f404
      AllTwoBootLocations: ami-075d08a821fe9441d
      Best10000Mbps: ami-01a63d80f7a1c70d8
      Best1000Mbps: ami-08ae2088cc946412c
      Best200Mbps: ami-066d13a1fa1c39306
      Best25Mbps: ami-048c736d280a4edcd
      Best5000Mbps: ami-044a89800da6e998a
    us-east-2:
      AdvancedWaf200Mbps: ami-0f9b8232bf88e5862
      AdvancedWaf25Mbps: ami-0fc89d05d4208ebb9
      AdvancedWaf3000Mbps: ami-0db2ead84757e773b
      AllTwoBootLocations: ami-0169d7c99adc0233d
      Best10000Mbps: ami-09f8091f3bdbd29ab
      Best1000Mbps: ami-0856fa969e51bbd92
      Best200Mbps: ami-0b5357e1b34cf7c4d
      Best25Mbps: ami-0643496689b45433d
      Best5000Mbps: ami-0c7ca45478f8efc35
    us-gov-east-1:
      AdvancedWaf200Mbps: ami-0a34f1861c1b5501e
      AdvancedWaf25Mbps: ami-043422feba1bceba2
      AdvancedWaf3000Mbps: ami-048d2bf31bdda7d7a
      AllTwoBootLocations: ami-09b40f2b42f6d6447
      Best10000Mbps: ami-0cec831d6c5efbfb7
      Best1000Mbps: ami-01edcd3b1c2e037c1
      Best200Mbps: ami-08e2d80817b9473c6
      Best25Mbps: ami-060b01517ae9df4c0
      Best5000Mbps: ami-098de2c1ac2f69ba4
    us-gov-west-1:
      AdvancedWaf200Mbps: ami-03046d828edbb2b9d
      AdvancedWaf25Mbps: ami-0e3275684fd4aaacd
      AdvancedWaf3000Mbps: ami-0e1537c2781f17ac1
      AllTwoBootLocations: ami-0404d4b0bce435472
      Best10000Mbps: ami-0d74330e24eda7d8e
      Best1000Mbps: ami-00cd82a8a66c19635
      Best200Mbps: ami-02c31a58044302431
      Best25Mbps: ami-022223d912cd89999
      Best5000Mbps: ami-0a036992697a5269b
    us-west-1:
      AdvancedWaf200Mbps: ami-02b5c0770b88a916b
      AdvancedWaf25Mbps: ami-088453c9e8c2794f9
      AdvancedWaf3000Mbps: ami-084e93258cde8e6e0
      AllTwoBootLocations: ami-0bf76e850f6b51fb6
      Best10000Mbps: ami-0f6ab8d64dbc912bc
      Best1000Mbps: ami-06952f316fbc4bf44
      Best200Mbps: ami-018d25e0f6fc89a9f
      Best25Mbps: ami-0500eeeb40f83b006
      Best5000Mbps: ami-0f8679bfd0e56203d
    us-west-2:
      AdvancedWaf200Mbps: ami-00665ee7689c90861
      AdvancedWaf25Mbps: ami-0c163c7a07a285d0f
      AdvancedWaf3000Mbps: ami-0b35ccd9406f1407d
      AllTwoBootLocations: ami-089182acbfc02e3bf
      Best10000Mbps: ami-011c5e1ee7cf0a28f
      Best1000Mbps: ami-04c9f40f04918d2b0
      Best200Mbps: ami-0550460dd9aacf4e2
      Best25Mbps: ami-0f732e141070ed5ee
      Best5000Mbps: ami-0ed5408c4bd9d05d1
  TMOS14146008:
    af-south-1:
      AdvancedWaf200Mbps: ami-0a68aef60c3f1ebbe
      AdvancedWaf25Mbps: ami-0c79d3b12f0411b61
      AdvancedWaf3000Mbps: ami-0e7583926a6e0988a
      AllTwoBootLocations: ami-0717736f43516565a
      Best10000Mbps: ami-0d250284a414da3b7
      Best1000Mbps: ami-07217436f2694aff6
      Best200Mbps: ami-090812da798a7d8c2
      Best25Mbps: ami-0d5e9c43e8891b8a7
      Best5000Mbps: ami-014407b39af8ed561
    ap-east-1:
      AdvancedWaf200Mbps: ami-0ab24827ea01875ff
      AdvancedWaf25Mbps: ami-05b821c53a6349d62
      AdvancedWaf3000Mbps: ami-0be10c43da08bbb9e
      AllTwoBootLocations: ami-088e5130c8b8a2633
      Best10000Mbps: ami-0b7b3d04ff19a01a1
      Best1000Mbps: ami-0ca60cf22ed01d10d
      Best200Mbps: ami-0507b4e86d348e360
      Best25Mbps: ami-087bb2767c1551912
      Best5000Mbps: ami-0594458956a617d24
    ap-northeast-1:
      AdvancedWaf200Mbps: ami-0181d41836f295d30
      AdvancedWaf25Mbps: ami-0f33df9f42072f0bf
      AdvancedWaf3000Mbps: ami-0970f25149b059e88
      AllTwoBootLocations: ami-072921e250bd455ea
      Best10000Mbps: ami-0129664a1431fb998
      Best1000Mbps: ami-06e92d2cd10fcf738
      Best200Mbps: ami-060fc9c10f99ae659
      Best25Mbps: ami-0e1b45e7c1a24d89f
      Best5000Mbps: ami-006b7dc339c3a381a
    ap-northeast-2:
      AdvancedWaf200Mbps: ami-007ace1d1fe5cc431
      AdvancedWaf25Mbps: ami-0b75d703c15a95ab8
      AdvancedWaf3000Mbps: ami-06f1d5b0b83d2f591
      AllTwoBootLocations: ami-0214b57de8f04b89f
      Best10000Mbps: ami-00dbf89de957a4d57
      Best1000Mbps: ami-097958341f6680038
      Best200Mbps: ami-0ddb9e82e2fadf8e5
      Best25Mbps: ami-0982e930cb004aa6e
      Best5000Mbps: ami-062deaf757533926e
    ap-northeast-3:
      AdvancedWaf200Mbps: ami-04c0b0b7fc90d7cca
      AdvancedWaf25Mbps: ami-03cba2a0f382ea29f
      AdvancedWaf3000Mbps: ami-0058872a6f2e9fe1a
      AllTwoBootLocations: ami-045ac9b4ace44953a
      Best10000Mbps: ami-0c7e62da14cb41638
      Best1000Mbps: ami-0011fd30f21a6e2dc
      Best200Mbps: ami-02cf86a9f542efa48
      Best25Mbps: ami-02bf87c2094953d61
      Best5000Mbps: ami-0cdce147cf90b434b
    ap-south-1:
      AdvancedWaf200Mbps: ami-07bcc89aced9f3537
      AdvancedWaf25Mbps: ami-0c7724c18be310a30
      AdvancedWaf3000Mbps: ami-07b0ce7f30e716455
      AllTwoBootLocations: ami-01550b903aadafdef
      Best10000Mbps: ami-04e75fd3a0d6f3544
      Best1000Mbps: ami-00d961431262c7449
      Best200Mbps: ami-04563d89468b2d98b
      Best25Mbps: ami-08a76bece1f27750b
      Best5000Mbps: ami-05db5f16b0a1c57f6
    ap-southeast-1:
      AdvancedWaf200Mbps: ami-0b3d4900a924270a6
      AdvancedWaf25Mbps: ami-0adaafa29e5e17353
      AdvancedWaf3000Mbps: ami-0690975c94542c20e
      AllTwoBootLocations: ami-096b5d3210488192e
      Best10000Mbps: ami-05fcfcad200c6922b
      Best1000Mbps: ami-0abc1787586e834e5
      Best200Mbps: ami-0ef7f15df913dc859
      Best25Mbps: ami-024ff0a05d6383bed
      Best5000Mbps: ami-0e87f3cfa140a17c8
    ap-southeast-2:
      AdvancedWaf200Mbps: ami-0b976100ff94e99ec
      AdvancedWaf25Mbps: ami-0a87766727a791e33
      AdvancedWaf3000Mbps: ami-023330c75d539b36a
      AllTwoBootLocations: ami-0a077d0c6f2c081bd
      Best10000Mbps: ami-09455e0f86dee138b
      Best1000Mbps: ami-02838e1ed690a1625
      Best200Mbps: ami-0e5772a9f0735f560
      Best25Mbps: ami-037a543b776d68c55
      Best5000Mbps: ami-0a33256040cc6ee78
    ca-central-1:
      AdvancedWaf200Mbps: ami-0d57366731a9a05a7
      AdvancedWaf25Mbps: ami-089ee55ce7f6fd06f
      AdvancedWaf3000Mbps: ami-0c83ffc68d59418be
      AllTwoBootLocations: ami-03b1169193240ebd0
      Best10000Mbps: ami-00759d9bab72ff6e4
      Best1000Mbps: ami-0c522edfd871bf4bc
      Best200Mbps: ami-0f7d78b4e1bbec15f
      Best25Mbps: ami-08f68c6de12a7152c
      Best5000Mbps: ami-08616195acc720bce
    eu-central-1:
      AdvancedWaf200Mbps: ami-0dda842f12e1ccde4
      AdvancedWaf25Mbps: ami-0e4a1334a0ce3d646
      AdvancedWaf3000Mbps: ami-049dae0d656004b73
      AllTwoBootLocations: ami-0cf6d03c56b3f4ac2
      Best10000Mbps: ami-08c9327986793df44
      Best1000Mbps: ami-0332e9ccb78c5a794
      Best200Mbps: ami-0483e3567f8c560b5
      Best25Mbps: ami-04d10528d1366f84d
      Best5000Mbps: ami-0d8ca7c33f07aa061
    eu-north-1:
      AdvancedWaf200Mbps: ami-05adced7270fb3ac7
      AdvancedWaf25Mbps: ami-0be9e8bbba08eebbf
      AdvancedWaf3000Mbps: ami-049841588d14cc1b8
      AllTwoBootLocations: ami-0c0f71cec8f430049
      Best10000Mbps: ami-06d509093f36e0ee8
      Best1000Mbps: ami-022c7da54db0c3dd5
      Best200Mbps: ami-0fcc7221a5382aab8
      Best25Mbps: ami-05184b00618e7308a
      Best5000Mbps: ami-0b0c0c5b1ab7a19b8
    eu-south-1:
      AdvancedWaf200Mbps: ami-04aca71dd79196a7f
      AdvancedWaf25Mbps: ami-0b9b12a1c3d054ee4
      AdvancedWaf3000Mbps: ami-0eb6a61e914a8e347
      AllTwoBootLocations: ami-0d449fff9e3d9c054
      Best10000Mbps: ami-058504a8067a3b416
      Best1000Mbps: ami-0cdc208158d548d3b
      Best200Mbps: ami-0e72cd9eaa790e6e3
      Best25Mbps: ami-0725bb8eec0b11d64
      Best5000Mbps: ami-0a82ca0ef35378d3c
    eu-west-1:
      AdvancedWaf200Mbps: ami-03a72e1cad0425052
      AdvancedWaf25Mbps: ami-065cc0b61ec513a54
      AdvancedWaf3000Mbps: ami-0612666e58bc5f739
      AllTwoBootLocations: ami-005172ca41ff2c932
      Best10000Mbps: ami-04d27f414a8f62085
      Best1000Mbps: ami-051af17a771dda8b9
      Best200Mbps: ami-00939b6ffda773dc0
      Best25Mbps: ami-032e2813d1c924e8b
      Best5000Mbps: ami-0b89a35d3f5f11e8d
    eu-west-2:
      AdvancedWaf200Mbps: ami-0a64a6009c1762182
      AdvancedWaf25Mbps: ami-045d67f7c7de5b77d
      AdvancedWaf3000Mbps: ami-0a3be40e3116a27b3
      AllTwoBootLocations: ami-0533bdc0640db341b
      Best10000Mbps: ami-0bf0cab4ad076033e
      Best1000Mbps: ami-0ebfab2a9ab1a765a
      Best200Mbps: ami-0130b25f9b488237f
      Best25Mbps: ami-02605e19d11730898
      Best5000Mbps: ami-0dbf4d8916532a56b
    eu-west-3:
      AdvancedWaf200Mbps: ami-01e8d97a901b7f0ac
      AdvancedWaf25Mbps: ami-0808e5e2261fc988a
      AdvancedWaf3000Mbps: ami-0fd4b5fdc716b5c44
      AllTwoBootLocations: ami-049f2492639cfd9cc
      Best10000Mbps: ami-077ff76d59e22c3d7
      Best1000Mbps: ami-07c98d390a73de90b
      Best200Mbps: ami-04cbe6b9c00744429
      Best25Mbps: ami-046cc5b79ce19277f
      Best5000Mbps: ami-02717a217be8a5368
    me-south-1:
      AdvancedWaf200Mbps: ami-0d6e209d081f5424b
      AdvancedWaf25Mbps: ami-0a639a1d7e6ac1bc6
      AdvancedWaf3000Mbps: ami-07631bdab4b604560
      AllTwoBootLocations: ami-0ddb312fcb0e11e37
      Best10000Mbps: ami-0513459ecd3365c05
      Best1000Mbps: ami-0ac4e5628baa5cf04
      Best200Mbps: ami-03c8afd6a015f9b42
      Best25Mbps: ami-073de26530ec3063b
      Best5000Mbps: ami-0f3fb6967a671e3ec
    sa-east-1:
      AdvancedWaf200Mbps: ami-0e9cccc0ea9ce1397
      AdvancedWaf25Mbps: ami-074f0371a2a1817c2
      AdvancedWaf3000Mbps: ami-052828ec4e59d6fc2
      AllTwoBootLocations: ami-09cb97125d5a64134
      Best10000Mbps: ami-08cbb8bf4d3a04aad
      Best1000Mbps: ami-0f58cb71cfed898d8
      Best200Mbps: ami-0ba022aa34976f9ae
      Best25Mbps: ami-08264c7e8f0897dc0
      Best5000Mbps: ami-040b13630cf03d2e6
    us-east-1:
      AdvancedWaf200Mbps: ami-0e813eb78b3afddeb
      AdvancedWaf25Mbps: ami-0e2e80c5ab6ce69f7
      AdvancedWaf3000Mbps: ami-0b89c5923f437d447
      AllTwoBootLocations: ami-08b3f6e8133bc9b16
      Best10000Mbps: ami-0d320a704a020cf37
      Best1000Mbps: ami-04c10417dc150cd23
      Best200Mbps: ami-095416a281055938d
      Best25Mbps: ami-0526d03e072a686fb
      Best5000Mbps: ami-0523120feadc63ef7
    us-east-2:
      AdvancedWaf200Mbps: ami-08a8afd3234e14543
      AdvancedWaf25Mbps: ami-0614ab99ed0bad6ca
      AdvancedWaf3000Mbps: ami-0f0c39d0601881406
      AllTwoBootLocations: ami-0be69c4757d8109ec
      Best10000Mbps: ami-097015b168074eac0
      Best1000Mbps: ami-0caef31e0b31c93ab
      Best200Mbps: ami-08b529f73cb3c0751
      Best25Mbps: ami-048e680b3f28c1b8f
      Best5000Mbps: ami-0a71b6ae9acee1c17
    us-gov-east-1:
      AdvancedWaf200Mbps: ami-0d217a425ab258710
      AdvancedWaf25Mbps: ami-04df2bad338438321
      AdvancedWaf3000Mbps: ami-04e9f670f47142ede
      AllTwoBootLocations: ami-02eca0a8f4a79c7b5
      Best10000Mbps: ami-0535b61b37199bd27
      Best1000Mbps: ami-0de2cd8f8e8466efb
      Best200Mbps: ami-0d7683aa6ec48c95a
      Best25Mbps: ami-0fcef0891e2fed2f3
      Best5000Mbps: ami-05fb1df42b0d768e4
    us-gov-west-1:
      AdvancedWaf200Mbps: ami-07b471c01b0e58e1b
      AdvancedWaf25Mbps: ami-021881fb4ba7b8587
      AdvancedWaf3000Mbps: ami-090728c77e9df0b95
      AllTwoBootLocations: ami-03521f797a6d0cd3a
      Best10000Mbps: ami-0292ba60001afd6de
      Best1000Mbps: ami-0fa26ebfed417f92c
      Best200Mbps: ami-07f94fd78768e5234
      Best25Mbps: ami-005ebcb210155a574
      Best5000Mbps: ami-04cbfac451265d937
    us-west-1:
      AdvancedWaf200Mbps: ami-0ee63d9ff9b6318da
      AdvancedWaf25Mbps: ami-0dfbc40361096c15e
      AdvancedWaf3000Mbps: ami-00fba7503a144b386
      AllTwoBootLocations: ami-03bcaa3aa12709719
      Best10000Mbps: ami-0b80bd7b235a50a55
      Best1000Mbps: ami-09109398e3ec11763
      Best200Mbps: ami-0851f73abc3de107c
      Best25Mbps: ami-02033409bcf5660b6
      Best5000Mbps: ami-043530c25e4cd1507
    us-west-2:
      AdvancedWaf200Mbps: ami-0b1712737c4159c4a
      AdvancedWaf25Mbps: ami-06cc1746b0de54f2b
      AdvancedWaf3000Mbps: ami-0df5c51a9decc6be0
      AllTwoBootLocations: ami-06abe27ad705571e4
      Best10000Mbps: ami-08ebcb256518d89a0
      Best1000Mbps: ami-0d034b4ce20ab2f77
      Best200Mbps: ami-029026ce5ed1c9cad
      Best25Mbps: ami-00f3354c008c0818d
      Best5000Mbps: ami-01c54ae69d6bf7217
Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
          default: Templates Location
        Parameters:
          - s3BucketRegion
          - s3BucketName
          - artifactLocation
      - Label:
          default: Network Configuration
        Parameters:
          - numAzs
          - numSubnets
      - Label:
          default: Amazon EC2 Configuration
        Parameters:
          - sshKey
          - restrictedSrcAddressMgmt
          - restrictedSrcAddressApp
          - bigIpInstanceProfile
      - Label:
          default: BIG-IP Configuration
        Parameters:
          - version
          - licenseType
          - bigIpImage
          - throughput
          - bigIpCustomImageId
          - bigIpInstanceType
          - numNics
          - bigIpRuntimeInitConfig
          - bigIpRuntimeInitPackageUrl
          - bigIpHostname
          - bigIpLicenseKey
          - provisionPublicIp
          - allowUsageAnalytics
      - Label:
          default: Application Configuration
        Parameters:
          - appContainerName
      - Label:
          default: Resources Tags
        Parameters:
          - uniqueString
          - application
          - cost
          - environment
          - group
          - owner
    ParameterLabels:
      allowUsageAnalytics:
        default: Send anonymous statistics to F5
      appContainerName:
        default: Docker Image Name
      application:
        default: Application
      artifactLocation:
        default: Directory Path
      bigIpCustomImageId:
        default: Custom Image Id
      bigIpHostname:
        default: Hostname for BIG-IP instance
      bigIpImage:
        default: F5 BIG-IP Performance Type (PAYG Only)
      bigIpInstanceProfile:
        default: Instance profile
      bigIpInstanceType:
        default: Instance Type
      bigIpLicenseKey:
        default: License key for BIG-IP instance
      bigIpRuntimeInitConfig:
        default: BIG-IP Runtime Init Config
      bigIpRuntimeInitPackageUrl:
        default: Runtime Init Package
      cost:
        default: Cost Center
      environment:
        default: Environment
      group:
        default: Group
      licenseType:
        default: License Type
      numAzs:
        default: Availability Zones
      numNics:
        default: Interfaces
      numSubnets:
        default: Subnets
      owner:
        default: Owner
      provisionPublicIp:
        default: Provision Public IP addresses for the BIG-IP management interface
      restrictedSrcAddressApp:
        default: Restricted source address to application
      restrictedSrcAddressMgmt:
        default: Restricted source address to BIG-IP
      s3BucketName:
        default: S3 Bucket
      s3BucketRegion:
        default: S3 Bucket Region
      sshKey:
        default: SSH public key
      throughput:
        default: BIG-IP VE throughput (PAYG Only)
      uniqueString:
        default: Unique String
      version:
        default: BIG-IP Version
  Version: 2.5.0.0
Outputs:
  bigIpInstanceId:
    Description: bigip's instance-id
    Value: !GetAtt [BigipStandalone, Outputs.bigIpInstanceId]
  bastionInstanceId:
    Condition: noPublicIp
    Description: bastion's instance-id
    Value: !GetAtt [Bastion, Outputs.bastionInstanceId]
  bastionPublicIp:
    Condition: noPublicIp
    Description: bastion's public IP address
    Value: !GetAtt [Bastion, Outputs.bastionPublicIp]
  bigIpManagementPrivateIp:
    Description: bigip's private management address
    Value: !GetAtt [BigipStandalone, Outputs.bigIpManagementInterfacePrivateIp]
  bigIpManagementPublicIp:
    Condition: publicIp
    Description: bigip's public management address. WARNING - For eval purposes only.
      Production should never have the management interface exposed to Internet
    Value: !GetAtt [Dag, Outputs.bigIpManagementEipAddress01]
  bigIpManagementSsh:
    Condition: publicIp
    Description: ssh login to bigip's management address. WARNING - For eval purposes
      only. Production should never have the management interface exposed to Internet
    Value: !Join
      - ''
      - - 'ssh admin@'
        - !GetAtt [Dag, Outputs.bigIpManagementEipAddress01]
  bigIpManagementUrl443:
    Condition: 2nicPublic
    Description: url to bigip's management address. WARNING - For eval purposes only.
      Production should never have the management interface exposed to Internet
    Value: !Join
      - ''
      - - 'https://'
        - !GetAtt [Dag, Outputs.bigIpManagementEipAddress01]
  bigIpManagementUrl8443:
    Condition: 1nicPublic
    Description: url to bigip's management address. WARNING - For eval purposes only.
      Production should never have the management interface exposed to Internet
    Value: !Join
      - ''
      - - 'https://'
        - !GetAtt [Dag, Outputs.bigIpManagementEipAddress01]
        - ':8443'
  vipPublicUrl:
    Description: url to public vip address
    Value: !Join
      - ''
      - - 'https://'
        - !GetAtt [Dag, Outputs.bigIpExternalEipAddress02]
Parameters:
  allowUsageAnalytics:
    AllowedValues:
      - 'true'
      - 'false'
    Default: 'true'
    Description: This deployment can send anonymous statistics to F5 to help us determine
      how to improve our solutions. If you select **false** statistics are not sent.
    Type: String
  appContainerName:
    Default: 'f5devcentral/f5-demo-app:latest'
    Description: Application docker image name
    Type: String
  application:
    Default: f5app
    Description: Application Tag.
    Type: String
  artifactLocation:
    AllowedPattern: ^.*[0-9a-zA-Z]+/$
    ConstraintDescription: 'key prefix can include numbers, lowercase letters, uppercase
      letters, hyphens (-), and forward slash (/).'
    Default: f5-aws-cloudformation-v2/v2.5.0.0/examples/
    Description: 'The path in the S3Bucket where the modules folder is located. Can
      include numbers, lowercase letters, uppercase letters, hyphens (-), and forward
      slash (/).'
    Type: String
  bigIpHostname:
    ConstraintDescription: Must be a valid hostname containing fewer than 63 characters.
    Default: 'bigip01.local'
    Description: Supply the hostname you would like to use for the BIG-IP instance.
      The hostname must contain fewer than 63 characters.
    MaxLength: 63
    Type: String
  bigIpLicenseKey:
    Default: ''
    Description: Supply the F5 BYOL license key for the BIG-IP instance. Leave this
      parameter blank if deploying the PAYG solution.
    Type: String
  bigIpRuntimeInitConfig:
    Default: 'https://f5-cft-v2.s3.amazonaws.com/f5-aws-cloudformation-v2/v2.5.0.0/examples/quickstart/bigip-configurations/runtime-init-conf-3nic-payg-with-app.yaml'
    Description: 'Supply a URL to the bigip-runtime-init configuration file in YAML
      or JSON format to use for f5-bigip-runtime-init configuration.'
    Type: String
  bigIpRuntimeInitPackageUrl:
    Default: 'https://cdn.f5.com/product/cloudsolutions/f5-bigip-runtime-init/v1.5.1/dist/f5-bigip-runtime-init-1.5.1-1.gz.run'
    Description: URL for BIG-IP Runtime Init package.
    Type: String
  cost:
    Default: f5costcenter
    Description: Cost Center Tag.
    Type: String
  bigIpCustomImageId:
    Default: ''
    Description: Provide BIG-IP AMI ID you wish to deploy.
    MaxLength: 255
    Type: String
  environment:
    Default: f5env
    Description: Environment Tag.
    Type: String
  group:
    Default: f5group
    Description: Group Tag.
    Type: String
  bigIpImage:
    AllowedValues:
      - Best
    ConstraintDescription: Must be a valid F5 BIG-IP VE image type
    Default: Best
    Description: F5 BIG-IP Performance Type
    Type: String
  bigIpInstanceProfile:
    Default: ''
    Description: Enter the name of an existing IAM instance profile with applied IAM
      policy to be associated to the BIG-IP virtual machine(s). Leave default if not
      using an instance profile.
    Type: String
  bigIpInstanceType:
    ConstraintDescription: Must be a valid EC2 instance type for BIG-IP
    Default: m5.2xlarge
    Description: Enter valid instance type.
    Type: String
  licenseType:
    AllowedValues:
      - payg
      - byol
    Default: payg
    Description: Specifies license type used for BIG-IP VE.
    Type: String
  numAzs:
    AllowedValues:
      - 1
      - 2
      - 3
      - 4
    Default: 1
    Description: Number of Availability Zones to use in the VPC. Region must support
      number of availability  zones entered. Min 1 Max 4.
    Type: Number
  numNics:
    AllowedValues:
      - 1
      - 2
      - 3
    Default: 3
    Description: Number of interfaces to create on BIG-IP instance. Maximum of 3 allowed.
      Minimum of 1 allowed.
    Type: Number
  numSubnets:
    AllowedValues:
      - 4
      - 5
      - 6
      - 7
      - 8
    Default: 4
    Description: Indicate the number of subnets to create.
    Type: Number
  owner:
    Default: f5owner
    Description: Owner Tag.
    Type: String
  provisionPublicIp:
    AllowedValues:
      - 'true'
      - 'false'
    Default: 'true'
    Description: Whether or not to provision Public IP Addresses for the BIG-IP Network
      Interfaces.
    Type: String
  restrictedSrcAddressApp:
    AllowedPattern: '(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})/(\d{1,2})'
    ConstraintDescription: Must be a valid IP CIDR range of the form x.x.x.x/x.
    Description: REQUIRED - The IP address range that can be used to access web traffic
      (80/443) to the EC2 instances.
    MaxLength: '18'
    MinLength: '9'
    Type: String
  restrictedSrcAddressMgmt:
    AllowedPattern: '(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})/(\d{1,2})'
    ConstraintDescription: Must be a valid IP CIDR range of the form x.x.x.x/x.
    Description: REQUIRED - The IP address range used to SSH and access BIG-IP management
      port.  Restrict to your client IP. Ex. X.X.X.X/32. WARNING - For eval purposes
      only. Production should never have Management interface exposed to Internet.
    MaxLength: '18'
    MinLength: '9'
    Type: String
  s3BucketName:
    AllowedPattern: '^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$'
    ConstraintDescription: 'S3 bucket name can include numbers, lowercase letters,
      uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).'
    Description: 'REQUIRED - S3 bucket name for the modules. S3 bucket name can include
      numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start
      or end with a hyphen (-).'
    Default: f5-cft-v2
    Type: String
  s3BucketRegion:
    Default: us-east-1
    Description: 'The AWS Region where the Quick Start S3 bucket (s3BucketName) is
      hosted. When using your own bucket, you must specify this value.'
    Type: String
  sshKey:
    Description: REQUIRED - Supply the public key that will be used for SSH authentication
      to the BIG-IP and application virtual machines.
    Type: 'AWS::EC2::KeyPair::KeyName'
  throughput:
    AllowedValues:
      - 25Mbps
      - 200Mbps
      - 1000Mbps
      - 5000Mbps
      - 10000Mbps
    ConstraintDescription: Select the BIG-IP throughput you want to use
    Default: 25Mbps
    Description: Maximum amount of throughput for BIG-IP VE.
    Type: String
  uniqueString:
    AllowedPattern: '^[a-zA-Z][a-zA-Z0-9]{1,11}$'
    ConstraintDescription: Must Contain between 1 and 12 alphanumeric characters with
      first character as a letter.
    Default: myUniqStr
    Description: Unique String used when creating object names or Tags.
    Type: String
  version:
    AllowedValues:
      - 16-1-3-1-0011
      - 14-1-4-6-008
    Default: 16-1-3-1-0011
    Description: Select version of BIG-IP you wish to deploy.
    Type: String
Resources:
  Application:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL: !Sub
        - 'https://${S3Bucket}.s3.${S3Region}.amazonaws.com/${artifactLocation}modules/application/application.yaml'
        - S3Region: !Ref 's3BucketRegion'
          S3Bucket: !Ref 's3BucketName'
      Parameters:
        appContainerName: !Ref 'appContainerName'
        application: !Ref 'application'
        applicationSubnet: !Select [3, !Split [',', !GetAtt [Network, Outputs.subnetsA]]]
        appSecurityGroupId: !GetAtt [Dag, Outputs.appSecurityGroupId]
        cost: !Ref 'cost'
        environment: !Ref 'environment'
        group: !Ref 'group'
        restrictedSrcAddress: !Ref 'restrictedSrcAddressApp'
        sshKey: !Ref 'sshKey'
        staticIp: "10.0.3.4"
        uniqueString: !Ref 'uniqueString'
        vpc: !GetAtt
          - Network
          - Outputs.vpcId
  Bastion:
    Type: 'AWS::CloudFormation::Stack'
    Condition: noPublicIp
    Properties:
      TemplateURL: !Sub
        - 'https://${S3Bucket}.s3.${S3Region}.amazonaws.com/${artifactLocation}modules/bastion/bastion.yaml'
        - S3Region: !Ref 's3BucketRegion'
          S3Bucket: !Ref 's3BucketName'
      Parameters:
        application: !Ref 'application'
        mgmtSubnet: !Join
          - ','
          - - !Select
              - '0'
              - !Split
                - ','
                - !GetAtt
                  - Network
                  - Outputs.subnetsA
        bastionSecurityGroupId: !GetAtt
          - Dag
          - Outputs.bastionSecurityGroupId
        cost: !Ref 'cost'
        createAutoscaleGroup: 'false'
        environment: !Ref 'environment'
        group: !Ref 'group'
        sshKey: !Ref 'sshKey'
        restrictedSrcAddress: !Ref 'restrictedSrcAddressMgmt'
        uniqueString: !Ref 'uniqueString'
        vpc: !GetAtt
          - Network
          - Outputs.vpcId
  BigipStandalone:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL: !Sub
        - 'https://${S3Bucket}.s3.${S3Region}.amazonaws.com/${artifactLocation}modules/bigip-standalone/bigip-standalone.yaml'
        - S3Region: !Ref 's3BucketRegion'
          S3Bucket: !Ref 's3BucketName'
      Parameters:
        allowUsageAnalytics: !Ref 'allowUsageAnalytics'
        bigIpRuntimeInitConfig: !Ref 'bigIpRuntimeInitConfig'
        externalPrimaryPublicId: !GetAtt [Dag, Outputs.bigIpExternalEipAllocationId01]
        externalPublicIpIds: !GetAtt [Dag, Outputs.bigIpExternalEipAllocationId02]
        externalSecurityGroupId: !If [2nic, !GetAtt [Dag, Outputs.bigIpExternalSecurityGroup],
          !Ref 'AWS::NoValue']
        externalSelfIp: !If [2nic, "10.0.0.11", !Ref 'AWS::NoValue']
        externalServiceIps: !If [1nic, "10.0.1.101", "10.0.0.101"]
        externalSubnetId: !If [2nic, !Select [0, !Split [',', !GetAtt [Network, Outputs.subnetsA]]],
          !Ref 'AWS::NoValue']
        hostname: !Ref 'bigIpHostname'
        imageId: !If [noCustomImageId, !If [isPaygLicensing, !FindInMap [!FindInMap [
                VERSION, !Ref 'version', REGIONMAP], !Ref 'AWS::Region', !FindInMap [
                AWSBigipThroughput, !Ref 'throughput', !Ref 'bigIpImage']], !FindInMap [
              !FindInMap [VERSION, !Ref 'version', REGIONMAP], !Ref 'AWS::Region',
              AllTwoBootLocations]], !Ref 'bigIpCustomImageId']
        instanceProfile: !If
          - useBigIpInstanceProfile
          - !Ref 'bigIpInstanceProfile'
          - !Ref 'AWS::NoValue'
        instanceType: !Ref 'bigIpInstanceType'
        internalSecurityGroupId: !If [3nic, !GetAtt [Dag, Outputs.bigIpInternalSecurityGroup],
          !Ref 'AWS::NoValue']
        internalSelfIp: !If [3nic, "10.0.2.11", !Ref 'AWS::NoValue']
        internalSubnetId: !If [3nic, !Select [2, !Split [',', !GetAtt [Network, Outputs.subnetsA]]],
          !Ref 'AWS::NoValue']
        licenseKey: !Ref 'bigIpLicenseKey'
        mgmtPublicIpId: !If [noPublicIp, !Ref 'AWS::NoValue', !GetAtt [Dag, Outputs.bigIpManagementEipAllocationId01]]
        mgmtSecurityGroupId: !GetAtt [Dag, Outputs.bigIpMgmtSecurityGroup]
        mgmtSelfIp: "10.0.1.11"
        mgmtSubnetId: !Select [1, !Split [',', !GetAtt [Network, Outputs.subnetsA]]]
        numSecondaryPrivateIpAddress: 1
        sshKey: !Ref 'sshKey'
        uniqueString: !Ref 'uniqueString'
  Dag:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL: !Sub
        - 'https://${S3Bucket}.s3.${S3Region}.amazonaws.com/${artifactLocation}modules/dag/dag.yaml'
        - S3Region: !Ref 's3BucketRegion'
          S3Bucket: !Ref 's3BucketName'
      Parameters:
        application: !Ref 'application'
        cost: !Ref 'cost'
        createAppSecurityGroup: 'true'
        createBastionSecurityGroup: !If [noPublicIp, 'true', 'false']
        createExternalSecurityGroup: !If [2nic, 'true', 'false']
        createInternalSecurityGroup: !If [3nic, 'true', 'false']
        environment: !Ref 'environment'
        group: !Ref 'group'
        numberPublicExternalIpAddresses: 2
        numberPublicMgmtIpAddresses: !If [noPublicIp, 0, 1]
        restrictedSrcAddressApp: !Ref 'restrictedSrcAddressApp'
        restrictedSrcAddressMgmt: !Ref 'restrictedSrcAddressMgmt'
        restrictedSrcPort: !If [1nic, 8443, 443]
        uniqueString: !Ref 'uniqueString'
        vpcCidr: 10.0.0.0/16
        vpc: !GetAtt
          - Network
          - Outputs.vpcId
  Network:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL: !Sub
        - 'https://${S3Bucket}.s3.${S3Region}.amazonaws.com/${artifactLocation}modules/network/network.yaml'
        - S3Region: !Ref 's3BucketRegion'
          S3Bucket: !Ref 's3BucketName'
      Parameters:
        cost: !Ref 'cost'
        environment: !Ref 'environment'
        group: !Ref 'group'
        numAzs: !Ref 'numAzs'
        numSubnets: !Ref 'numSubnets'
        setPublicSubnet1: !Ref 'provisionPublicIp'
        subnetMask: 24
        uniqueString: !Ref 'uniqueString'
        vpcCidr: 10.0.0.0/16
